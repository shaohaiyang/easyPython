{# templates/index.html #}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title> Notification System </title>
  <link  href="https://ddt.ddz.me/static/bootstrap.min.css" rel="stylesheet">
  <link  href="https://ddt.ddz.me/static/jquery.datetimepicker.css" rel="stylesheet"/>
  <script src="https://ddt.ddz.me/static/bootstrap.bundle.min.js"></script>
  <script src="https://ddt.ddz.me/static/jquery.min.js"></script>
  <script src="https://ddt.ddz.me/static/jquery.datetimepicker.js"></script>
  <script src="https://ddt.ddz.me/static/alpine.min.js"></script>
  <script src="https://ddt.ddz.me/static/htmx.min.js"></script>

  <script>
  $(document).ready(function() {
    // Get click event, assign button to var, and get values from that var
    $('#aBtnGroup button').on('click', function() {
      var thisBtn = $(this);
      thisBtn.addClass('active').siblings().removeClass('active');
      var btnText = thisBtn.text();
      var btnValue = thisBtn.val();
      $('#selectedVal').text(btnValue);
    document.getElementById("msg_type").value = btnValue;
    });
    // You can use this to set default value
    $('#aBtnGroup button[value="0"]').click();
    $("[data-toggle='tooltip']").tooltip(); 
    $('#myDatePicker').datetimepicker({
      date: new Date(),
      language: 'zh',
      firstDayOfWeek: 1,
      viewMode: 'YMDHM',
      onOk: function() {
	var timeValue = this.getText();
	var date1 = Math.floor(Date.now() / 1000)
	var date2 = Math.floor(new Date(timeValue).getTime() / 1000);

	//alert(timeValue +  "å®šæ—¶ï¼š" + date2 + " å½“å‰ï¼š" + date1);
	if ( date2 < date1 + 80 ){
	  alert("ä½ çš„å®šæ—¶æ—¶é—´å¤ªçŸ­äº†! è‡³å°‘å»¶æ—¶ä¸‰åˆ†é’Ÿä»¥ä¸Šå§ï¼Ÿ ");
	  return false;
	}
	else {
	  $('#submit').text("å®šæ—¶å‘é€ â° æ—¶é—´:  " + timeValue);
	  document.getElementById("send_time").value = timeValue;
	}
      },
      onClear: function() {
	document.getElementById("send_time").value = "";
	$('#submit').text("å‘ é€! ğŸš€");
      },
    });
  });
  
  function validateForm() {
     var x = document.forms["myForm"]["message"].value;
     if ( x == null || x == "" ) {
        alert("æ²¡æœ‰å•¥äº‹å°±åˆ«å‘äº†ã€‚");
        return false;
     }
  }

  </script>

  <style type="text/css">
      body{
          padding: 20px;
      }

      table {
          font-family: arial, sans-serif;
          border-collapse: collapse;
          width: 100%;
      }

      tr.htmx-swapping td {
          opacity: 0;
          transition: opacity 0.3s ease-out;
      }

      td, th {
          border: 1px solid #383737;
          text-align: left;
          padding: 8px;
      }

      tr:nth-child(even) {
          background-color: #eeeeff;
      }

      div {
          margin:10px 0;
      }
  </style>
</head>
<!-- Place <body> </body> code here
-->
<body>
<h1>å•å•å¼¹é€šçŸ¥ç³»ç»Ÿä¸Šçº¿äº†!  â¤ï¸ </h1>

<ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
  <li class="nav-item" role="presentation">
  <button class="nav-link btn btn-info" id="pills-new-tab" data-bs-toggle="pill" data-bs-target="#pills-new" type="button" role="tab" aria-controls="pills-new" aria-selected="true">å‘å¸ƒæ–°é€šçŸ¥</button>
  </li>
  <li class="nav-item" role="presentation">
  <button class="nav-link btn btn-danger active" id="pills-view-tab" data-bs-toggle="pill" data-bs-target="#pills-view" type="button" role="tab" aria-controls="pills-view" aria-selected="false">&nbsp;æŸ¥çœ‹é€šçŸ¥&nbsp;</button>
  </li>
</ul>

<div class="tab-content" id="pills-tabContent">
  <div class="tab-pane fade show " id="pills-new" role="tabpanel" aria-labelledby="pills-new-tab">
      <form name="myForm" hx-post="/submit" onsubmit="return validateForm()" hx-swap="beforebegin" hx-target="#new-msg" class="mb-3">
      <br>
      <div class="form-check form-switch">
      <input class="form-check-input" type="checkbox" id="mySwitch" name="msg_speak">
      <label class="badge bg-primary" style="font-size:17px;" for="mySwitch"> ğŸ”” å¼€å¯è¯­éŸ³æ’­æŠ¥</label>
      </div>
      <br>
      <div id="aBtnGroup" class="btn-group">
      <button type="button" class="btn btn-success btn-lg" data-bs-placement="top" data-toggle="tooltip" title="ç³»ç»Ÿè‡ªå¸¦&æ¶ˆæ¯å¼¹æ¡†" value="0">ğŸ’¬&nbsp;ä¸€èˆ¬æ¶ˆæ¯&nbsp;</button>
      <button type="button" class="btn btn-warning btn-lg" data-bs-placement="top" data-toggle="tooltip" title="å±å¹•å±…ä¸­&å‰ç½®æ˜¾ç¤º" value="1">ğŸ“Œ&nbsp;é‡è¦æ¶ˆæ¯&nbsp;</button>
      <button type="button" class="btn btn-danger  btn-lg" data-bs-placement="top" data-toggle="tooltip" title="å…¨å±æ¶ˆæ¯&é€€æ ¼é”®å…³é—­" value="2">ğŸ‘&nbsp;ç´§æ€¥æ¶ˆæ¯&nbsp;</button>
      </div>
      <br>
      <br>

      <input type="hidden" id="send_time" value="" name="send_time"/>
      <input type="hidden" id="msg_type" value="" name="msg_type"/>
      <input type="text" name="title" value="å­¦æ ¡é€šçŸ¥" class="form-control form-control-lg mb-3" />
      <textarea class="form-control form-control-lg mb-3" name="message" rows="5" placeholder="æ¶ˆæ¯å†…å®¹ï¼Œæ²¡æœ‰å†…å®¹å‘ä¸äº†å“¦ï¼" ></textarea>
      <div id="myDatePicker"></div>
      <button type="submit" class="btn btn-danger" id="submit">&nbsp;å‘&nbsp;å¸ƒ&nbsp;! ğŸš€</button>
      </form>
  </div>
  
  <div class="tab-pane fade show active" id="pills-view" role="tabpanel" aria-labelledby="pills-view-tab">
    <table class="table table-hover">
    <thead>
      <tr class="text-warning bg-dark">
        <th scope="col">é€šçŸ¥æ ‡é¢˜</th>
        <th scope="col">æ¶ˆæ¯å†…å®¹</th>
        <th scope="col">é˜…è¯»äººæ•°</th>
        <th scope="col">å‘å¸ƒæ—¶é—´</th>
      </tr>
    </thead>
    <tbody id="new-msg" hx-target="closest tr" hx-swap="outerHTML swap:0.3s">
      {%for post in data%}
      <tr>
{% if post.type == "1" %}
        <td class="text-primary"><b>
{% elif post.type == "2" %}
        <td class="text-danger"><b>
{% else %}
        <td>
{% endif %}
        {{post.title}}
        </td>
        <td>
      <span id="msg" class="d-inline-block text-truncate" style="max-width:400px;" data-toggle="tooltip" title={{post.message}}> {{post.message}} </span>
	  </td>
          <td>{{post.views}}</td>
          <td>{{post.createdAt}}</td>
      </tr> 
      {%endfor%}
    </tbody>
    </table>
  </div>
</div>
</body>
</html>
